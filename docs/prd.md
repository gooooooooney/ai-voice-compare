# AI语音对比工具 Product Requirements Document (PRD)

## 目标和背景环境

### 目标
- 为开发者和技术决策者提供客观的实时语音转文字API性能对比数据
- 实现无服务器依赖的纯前端AI语音API对比解决方案
- 建立可扩展的语音API基准测试框架
- 在2周内交付功能完整的MVP对比工具

### 背景环境

当前市场上缺乏便捷的工具来直接对比不同实时语音转文字服务的性能表现。开发者在选择Deepgram和AssemblyAI等语音API时，往往需要分别测试不同服务，无法进行直观的实时对比，这导致决策困难和测试成本高昂。

本项目旨在开发一个创新的纯前端网页应用，同时连接两个领先的语音API提供商，提供实时转录对比和性能指标分析，帮助用户在相同条件下评估服务差异，做出明智的技术选型决策。

### 变更日志

| 日期 | 版本 | 描述 | 作者 |
|------|------|------|------|
| 2025-01-22 | v1.0 | 初始PRD创建，基于分析师项目简介 | John (PM) |

## 需求

### 功能需求

1. **FR1:** 系统必须支持浏览器麦克风权限获取和音频流捕获
2. **FR2:** 系统必须同时建立与Deepgram和AssemblyAI的WebSocket实时连接
3. **FR3:** 系统必须实时显示两个API的转录结果在分屏界面中
4. **FR4:** 系统必须测量并显示每个API的响应延迟（毫秒级精度）
5. **FR5:** 系统必须提供开始/停止录音的控制功能
6. **FR6:** 系统必须显示两个API的连接状态（已连接/断开/错误）
7. **FR7:** 系统必须计算并显示平均延迟、总词数等性能对比指标
8. **FR8:** 系统必须支持API密钥配置（支持环境变量或用户输入）
9. **FR9:** 系统必须支持音频采样率配置（16kHz、44.1kHz、48kHz）
10. **FR10:** 系统必须处理API连接错误并提供用户友好的错误提示

### 非功能需求

1. **NFR1:** 系统平均转录延迟必须小于200毫秒
2. **NFR2:** API连接成功率必须达到95%以上
3. **NFR3:** 系统必须兼容Chrome 88+、Firefox 87+、Safari 14+、Edge 88+浏览器
4. **NFR4:** 系统必须支持响应式设计，适配桌面端和移动端
5. **NFR5:** 系统首次加载时间必须小于3秒
6. **NFR6:** 系统必须使用HTTPS协议确保麦克风访问安全性
7. **NFR7:** 系统单次测试会话内存使用不得超过100MB
8. **NFR8:** 系统必须提供无障碍访问支持（键盘导航、屏幕阅读器兼容）

## 用户界面设计目标

### 整体UX愿景

创建一个简洁直观的实时对比界面，让用户能够立即看到两个语音API的性能差异。重点关注清晰的视觉层次和即时反馈，确保用户可以在2分钟内完成完整的对比测试并获得有意义的结果。

### 关键交互范式

- **实时对称对比**：左右分屏展示两个API结果，保持视觉平衡
- **一键操作**：简化录音控制为单个开始/停止按钮
- **状态可视化**：通过颜色和图标清晰传达连接状态和性能差异
- **渐进式披露**：基础功能优先展示，高级配置可折叠

### 核心界面和视图

- **主对比界面**：包含录音控制、实时转录面板、性能指标的单页应用
- **配置面板**：API密钥设置和音频参数配置（可折叠）
- **错误处理界面**：权限请求、连接失败的友好引导界面
- **结果总结视图**：测试完成后的性能对比汇总

### 可访问性：WCAG AA

确保键盘导航、屏幕阅读器兼容、高对比度支持，满足WCAG 2.1 AA标准。

### 品牌形象

采用现代简约设计风格，使用蓝色系（Deepgram）和橙色系（AssemblyAI）的品牌色彩进行API区分，整体保持专业的技术工具感。

### 目标设备和平台：Web响应式

主要针对桌面端（>1024px）优化，同时确保在平板（768px-1024px）和移动端（<768px）的良好可用性。移动端采用垂直堆叠布局替代桌面端的左右分屏。

## 技术假设

### 代码库结构：单仓库

采用单仓库（Monorepo）结构，包含前端应用和可选的辅助工具。项目规模较小，单仓库便于管理和部署。

### 服务架构

**纯前端架构（Client-side Only）**：无需后端服务器，直接通过浏览器连接到Deepgram和AssemblyAI的API。这种架构选择基于以下考虑：
- 降低部署和维护复杂度
- 符合MVP快速交付要求
- 减少基础设施成本
- 充分利用两个API的浏览器兼容性

### 测试要求

**单元测试 + 集成测试**：
- 单元测试覆盖核心功能模块（音频处理、延迟计算、状态管理）
- 集成测试验证API连接和实时数据流
- 手动测试用于用户体验验证和跨浏览器兼容性确认
- 目标测试覆盖率：核心功能85%以上

### 其他技术假设和要求

- **前端技术栈**：原生JavaScript (ES6+) + Web APIs，避免引入大型框架以保持轻量
- **构建工具**：可选Vite用于开发服务器和生产构建优化
- **API集成**：
  - Deepgram：直接CDN加载JavaScript SDK
  - AssemblyAI：CDN加载流转录专用版本，服务端生成临时令牌
- **音频处理**：MediaRecorder API + Web Audio API进行音频捕获和处理
- **状态管理**：原生JavaScript类和事件系统，无需外部状态管理库
- **样式方案**：CSS3 + CSS变量，响应式网格布局
- **部署目标**：静态网站托管（Netlify/Vercel/GitHub Pages），要求HTTPS支持
- **浏览器兼容性**：支持ES6+和现代Web APIs的浏览器（2019年后版本）
- **性能优化**：代码分割、资源懒加载、WebSocket连接池管理
- **错误监控**：集成轻量级错误追踪（如Sentry Lite或自定义方案）

## 史诗列表

### 史诗概览

**Epic 1: 基础架构与核心连接** - 建立项目基础设施、API连接框架和基本音频捕获功能

**Epic 2: 实时转录对比界面** - 实现双API实时转录显示和基础性能指标

**Epic 3: 高级指标与用户体验** - 添加详细性能分析、错误处理和用户体验优化

## Epic 1: 基础架构与核心连接

**目标：** 建立完整的项目基础设施，实现与Deepgram和AssemblyAI的稳定连接，并提供基本的音频捕获功能。此史诗将交付一个可验证API连接和音频处理能力的基础应用，为后续开发奠定技术基础。

### Story 1.1: 项目初始化与开发环境

作为开发者，
我想要建立完整的项目结构和开发环境，
以便能够高效地进行后续功能开发。

**验收标准：**
1. 创建标准的HTML5项目结构，包含index.html、styles.css、app.js主要文件
2. 配置支持ES6模块的开发服务器（推荐使用Vite或http-server）
3. 建立Git版本控制，包含合适的.gitignore文件
4. 创建基础的README.md，包含项目说明和运行指南
5. 配置HTTPS开发环境以支持麦克风访问
6. 验证项目可在本地成功启动并显示"Hello World"页面

### Story 1.2: Deepgram SDK集成与连接

作为开发者，
我想要集成Deepgram JavaScript SDK并建立WebSocket连接，
以便能够进行实时语音转录测试。

**验收标准：**
1. 通过CDN成功加载Deepgram JavaScript SDK
2. 实现API密钥配置功能（支持环境变量或配置文件）
3. 建立与Deepgram实时转录服务的WebSocket连接
4. 实现连接状态监控（连接中、已连接、断开、错误）
5. 在浏览器控制台显示连接状态变化日志
6. 实现连接错误处理和重连机制
7. 验证连接可以正常建立并保持稳定

### Story 1.3: AssemblyAI SDK集成与令牌认证

作为开发者，
我想要集成AssemblyAI流转录SDK并实现安全的令牌认证，
以便能够进行实时语音转录测试。

**验收标准：**
1. 通过CDN成功加载AssemblyAI流转录SDK
2. 实现临时令牌生成功能（可使用简单的服务端脚本或模拟）
3. 建立与AssemblyAI实时转录服务的连接
4. 实现连接状态监控和错误处理
5. 在浏览器控制台显示连接状态和令牌信息
6. 验证令牌过期和刷新机制正常工作
7. 确保连接安全性符合AssemblyAI最佳实践

### Story 1.4: 浏览器音频捕获实现

作为用户，
我想要授权应用访问我的麦克风并捕获音频，
以便能够进行语音转录测试。

**验收标准：**
1. 实现麦克风权限请求功能，包含友好的用户提示
2. 使用MediaRecorder API成功捕获音频流
3. 支持多种音频格式和采样率配置（16kHz、44.1kHz、48kHz）
4. 在界面显示音频捕获状态（准备、录音中、停止）
5. 实现音频数据的实时处理和分块传输
6. 提供权限被拒绝时的友好错误处理
7. 验证音频质量满足语音转录要求

### Story 1.5: 基础音频流传输

作为开发者，
我想要将捕获的音频数据实时传输给两个API，
以便验证完整的数据流管道。

**验收标准：**
1. 实现音频数据向Deepgram WebSocket的实时传输
2. 实现音频数据向AssemblyAI流转录器的实时传输
3. 确保音频数据格式兼容两个API的要求
4. 实现传输错误检测和处理机制
5. 在控制台显示音频数据传输日志
6. 验证两个API都能接收到音频数据
7. 测试不同音频质量设置下的传输稳定性

## Epic 2: 实时转录对比界面

**目标：** 实现核心的实时转录对比功能，包括双API结果显示、基础性能指标和用户控制界面。此史诗将交付完整的MVP功能，用户可以进行实时语音对比测试并获得有意义的结果。

### Story 2.1: 双面板转录显示界面

作为用户，
我想要在分屏界面中同时查看两个API的转录结果，
以便能够直观地比较它们的准确性和响应速度。

**验收标准：**
1. 创建响应式的左右分屏布局（桌面端）或上下布局（移动端）
2. 左侧面板显示Deepgram转录结果，使用蓝色主题
3. 右侧面板显示AssemblyAI转录结果，使用橙色主题
4. 转录文本实时更新，支持部分转录和最终转录的区分显示
5. 每个面板显示API名称、连接状态指示器
6. 实现文本滚动和历史转录内容保持
7. 在移动设备上提供滑动切换查看功能

### Story 2.2: 录音控制与状态管理

作为用户，
我想要简单地开始和停止录音测试，
以便能够控制何时进行语音对比。

**验收标准：**
1. 提供明显的"开始录音"和"停止录音"按钮
2. 按钮状态根据当前录音状态动态变化（可用/不可用/录音中）
3. 显示全局状态指示器（准备就绪、录音中、处理中、错误）
4. 实现录音会话管理，支持多次开始/停止操作
5. 在录音过程中显示音频输入电平指示器
6. 提供键盘快捷键支持（空格键开始/停止）
7. 在录音开始前检查所有前置条件（权限、API连接等）

### Story 2.3: 实时延迟测量与显示

作为用户，
我想要实时查看两个API的响应延迟，
以便能够比较它们的实时性能表现。

**验收标准：**
1. 实现精确的延迟测量机制（音频发送时间戳到转录接收时间戳）
2. 在每个API面板显示当前转录的延迟时间（毫秒）
3. 计算并显示会话的平均延迟
4. 使用颜色编码指示延迟水平（绿色：<100ms，黄色：100-200ms，红色：>200ms）
5. 提供延迟历史图表或趋势显示
6. 支持延迟数据的本地存储和会话重置
7. 在控制台输出详细的延迟分析数据

### Story 2.4: 基础性能指标面板

作为用户，
我想要查看详细的性能对比指标，
以便能够全面评估两个API的表现差异。

**验收标准：**
1. 创建专门的性能指标展示区域
2. 显示总转录词数对比（Deepgram vs AssemblyAI）
3. 显示平均延迟对比和最大/最小延迟
4. 显示连接稳定性指标（连接时间、断线次数）
5. 提供会话总时长和有效转录时间统计
6. 实现指标数据的实时更新和累计计算
7. 支持性能数据导出为JSON格式

### Story 2.5: 转录结果差异高亮

作为用户，
我想要看到两个API转录结果的具体差异，
以便能够评估它们的准确性差别。

**验收标准：**
1. 实现转录文本的差异检测算法
2. 使用不同颜色高亮显示文本差异（添加、删除、修改）
3. 提供逐词对比和整句对比两种模式
4. 显示差异统计数据（相同词汇百分比、差异词数）
5. 支持忽略大小写和标点符号的对比选项
6. 实现差异导航功能，快速跳转到不同位置
7. 在转录完成后提供完整的差异分析报告

## Epic 3: 高级指标与用户体验

**目标：** 完善产品的用户体验，添加高级性能分析功能、完善错误处理机制、并确保产品达到生产就绪状态。此史诗将交付一个完整的、用户友好的专业级语音API对比工具。

### Story 3.1: 高级配置与设置面板

作为高级用户，
我想要自定义音频参数和API设置，
以便能够在不同条件下进行专业的对比测试。

**验收标准：**
1. 创建可折叠的高级配置面板
2. 提供API密钥安全输入和保存功能（支持本地存储）
3. 支持音频采样率、编码格式的详细配置
4. 提供音频增益调节和噪声抑制选项
5. 支持自定义延迟测量参数和统计窗口
6. 实现配置导入/导出功能
7. 提供配置重置为默认值的选项

### Story 3.2: 错误处理与用户引导

作为用户，
我想要在遇到问题时获得清晰的指导，
以便能够快速解决问题并继续使用应用。

**验收标准：**
1. 实现全面的错误分类和友好错误消息
2. 提供麦克风权限被拒绝的详细解决指南
3. 创建API连接失败的诊断和修复建议
4. 实现网络问题的自动检测和用户提示
5. 提供"一键诊断"功能检查所有系统状态
6. 添加帮助文档和常见问题解答界面
7. 实现错误日志收集和本地调试信息显示

### Story 3.3: 数据可视化与分析报告

作为用户，
我想要通过图表和报告深入分析测试结果，
以便能够做出更准确的技术选型决策。

**验收标准：**
1. 实现延迟趋势的实时折线图显示
2. 创建性能对比的雷达图或柱状图
3. 提供测试会话的详细分析报告页面
4. 支持多次测试会话的历史数据对比
5. 实现数据的CSV/JSON格式导出功能
6. 提供统计学指标（平均值、中位数、标准差）
7. 创建可分享的测试结果摘要界面

### Story 3.4: 移动端优化与无障碍支持

作为移动设备用户，
我想要在手机或平板上正常使用对比工具，
以便能够随时随地进行语音API测试。

**验收标准：**
1. 优化移动端的触控交互和界面布局
2. 实现移动端专用的导航和控制方式
3. 确保在小屏幕上的信息层次清晰可读
4. 提供完整的键盘导航支持
5. 实现屏幕阅读器兼容性
6. 支持高对比度模式和字体大小调节
7. 通过WCAG 2.1 AA级别的无障碍测试

### Story 3.5: 性能优化与生产部署

作为产品负责人，
我想要确保应用具备生产级别的性能和稳定性，
以便能够为用户提供可靠的服务体验。

**验收标准：**
1. 实现资源懒加载和代码分割优化
2. 添加Service Worker支持离线基础功能
3. 实现内存使用监控和自动清理机制
4. 优化WebSocket连接管理和重连策略
5. 添加性能监控和用户体验指标收集
6. 配置生产环境的错误监控和日志系统
7. 完成跨浏览器兼容性测试和性能基准测试

## 检查清单结果报告

### 执行概要

- **整体PRD完整性**: 92% 完成
- **MVP范围适当性**: ✅ 恰到好处 - 功能聚焦核心价值，技术实现可行
- **架构阶段准备度**: ✅ 已准备就绪 - 技术约束清晰，需求明确
- **最关键优势**: 纯前端架构降低复杂度，实时对比提供差异化价值

### 分类分析表

| 分类                     | 状态     | 关键问题 |
| ------------------------ | -------- | -------- |
| 1. 问题定义与背景        | ✅ PASS   | 无       |
| 2. MVP范围定义           | ✅ PASS   | 无       |
| 3. 用户体验需求          | ✅ PASS   | 无       |
| 4. 功能需求              | ✅ PASS   | 无       |
| 5. 非功能需求            | ✅ PASS   | 无       |
| 6. 史诗与故事结构        | ✅ PASS   | 无       |
| 7. 技术指导              | ✅ PASS   | 无       |
| 8. 跨功能需求            | ⚠️ PARTIAL | 临时令牌生成需要轻量级后端支持 |
| 9. 清晰度与沟通          | ✅ PASS   | 无       |

### 按优先级排列的问题

**中等优先级:**
- 需要为AssemblyAI临时令牌生成提供简单的服务端解决方案或模拟机制
- 考虑在Epic 1中明确token服务的实现策略

**低优先级:**
- 可以在Epic 3中添加更详细的性能基准和监控指标
- 建议增加用户反馈收集机制用于产品迭代

### MVP范围评估

**✅ 范围恰当性:**
- Epic 1建立技术基础，包含必要的"Hello World"验证
- Epic 2实现核心价值主张，提供完整的对比功能
- Epic 3完善产品体验，确保生产就绪

**✅ 时间线现实性:**
- 3个史诗适合2周开发周期
- 每个史诗5个故事，规模合理
- 技术选择（原生JS，静态部署）支持快速交付

**✅ 技术复杂度:**
- 纯前端架构显著降低部署复杂度
- WebSocket集成是最大技术风险，但有清晰的实现路径
- 两个API都有良好的浏览器支持

### 技术准备度

**✅ 技术约束清晰度:**
- 架构决策有明确说明和权衡分析
- 浏览器兼容性要求具体
- 性能目标量化且可测试

**⚠️ 已识别技术风险:**
- AssemblyAI令牌认证需要服务端组件（建议用Netlify Functions或类似方案）
- CORS问题可能需要代理配置
- 音频格式兼容性需要早期验证

**✅ 架构师调研领域:**
- 音频处理和实时流传输优化
- WebSocket连接管理和重连策略
- 客户端状态管理和内存优化

### 建议

**立即行动:**
1. **确认令牌策略**: 为AssemblyAI临时令牌选择实现方案（Netlify Functions推荐）
2. **API密钥管理**: 明确开发和生产环境的密钥处理方式

**改进建议:**
1. **技术验证**: 建议在Epic 1中优先验证两个API的浏览器直连可行性
2. **性能基准**: 在Epic 3中添加自动化性能测试和基准比较
3. **用户反馈**: 考虑集成简单的使用分析以支持产品迭代

### 最终决定

**✅ 已准备交付架构师**: PRD和史诗文档全面、结构合理，已准备好进行架构设计阶段。技术约束清晰，MVP范围适当，实现路径明确。

## 下一步

### UX专家提示

请基于此PRD创建详细的用户体验设计，重点关注实时对比界面的信息架构和交互流程。确保双API对比的视觉层次清晰，延迟指标突出显示。

### 架构师提示

请基于此PRD进入架构创建模式，重点关注：1) 纯前端架构的音频流处理优化，2) WebSocket连接管理和错误恢复策略，3) AssemblyAI临时令牌的轻量级服务端实现方案。优先验证技术可行性并建立项目基础架构。
